<html><head><script type="text/javascript" src="assets/app.js"></script> <script defer type="text/javascript" src="assets/alpine.js"></script><link rel="stylesheet" href="assets/styles.css"><link rel="stylesheet" href="assets/prism.css"><link rel="icon" type="image/x-icon" href="assets/favicon.ico"><title>More SQL Please: UNION and Set Operators</title></head><body class="language-sql"><div class="content wide"><div class="title"><h1 class="heading"><a href="/">More SQL Please</a>: <span class="title-em">UNION and Set Operators</span></h1></div><details id="schema" class="toggle"><summary class="action heading" data-open="hide tables" data-close="show tables"></summary><div class="container"><div class="tile"><div class="tablename"><span><span class="inline-code"><code>products</code></span></span></div><pre class="table">| id |           name           |  category  | price | remaining_stock | vendor_id |
|----|--------------------------|------------|-------|-----------------|-----------|
| 1  | Cool Splash Cologne      | Toiletries | 49.99 | 25              | 2         |
| 2  | More Spice Please Chips  | Food       | 3.99  | 60              | 1         |
| 3  | Night Shift Coffee       | Food       | 6.99  | 1               | 1         |
| 4  | Crunchy Munchy Trail Mix | Food       | 8.99  | 5               | 3         |
| 5  | Super Glide Floss        | Toiletries | 1.99  | 19              | 4         |
| 6  | Big Bark Dog Food        | Pet Care   | 30    | 2               | 2         |
| 7  | Soft Purr Cat Food       | Pet Care   | 30    | 2               | 2         |
| 8  | Tiny Fresh Scent Tree    | Automotive | 2     | 7               | 4         |
</pre></div><div class="tile"><div class="tablename"><span><span class="inline-code"><code>orders</code></span></span></div><pre class="table">| id | product_id | quantity |    date_ordered     |    date_arrived     |
|----|------------|----------|---------------------|---------------------|
| 1  | 4          | 40       | 2024-06-01 07:58:05 | 2024-06-03 09:04:05 |
| 2  | 1          | 20       | 2024-06-14 19:30:10 | 2024-06-26 14:20:10 |
| 3  | 5          | 50       | 2024-07-03 01:00:07 | 2024-07-09 12:50:12 |
| 4  | 2          | 60       | 2024-07-24 06:06:03 | 2024-07-30 15:05:00 |
| 5  | 3          | 60       | 2024-08-15 16:40:07 | 2024-08-19 07:05:00 |
| 6  | 6          | 10       | 2024-09-01 08:01:01 | NULL                |
</pre></div><div class="tile"><div class="tablename"><span><span class="inline-code"><code>archived_orders_2023</code></span></span></div><pre class="table">| id | product_id | quantity |    date_ordered     |    date_arrived     |
|----|------------|----------|---------------------|---------------------|
| 7  | 1          | 20       | 2023-12-15 10:30:00 | 2023-12-20 14:15:00 |
| 8  | 2          | 25       | 2023-11-28 08:45:22 | 2023-12-02 11:20:15 |
| 9  | 4          | 40       | 2023-08-22 11:05:15 | 2023-08-29 15:30:00 |
| 10 | 8          | 100      | 2023-07-14 09:20:00 | 2023-07-18 10:15:30 |
| 11 | 6          | 5        | 2023-06-30 14:55:25 | 2023-07-05 16:40:10 |
| 12 | 7          | 10       | 2023-05-12 07:30:00 | 2023-05-16 13:25:45 |
</pre></div></div></details> <div class="container"><div><p>The  <span><span class="inline-code"><code>UNION</code></span></span> operator allows you to combine two sets of result rows into one.</p><p>A  <span><span class="inline-code"><code>UNION</code></span></span> is different than a  <span><span class="inline-code"><code>JOIN</code></span></span>. Think of a  <span><span class="inline-code"><code>JOIN</code></span></span> as a way to combine columns "horizontally" from different tables, whereas a  <span><span class="inline-code"><code>UNION</code></span></span> is a way to stack rows "vertically" on top of one another.</p><p>In order for a  <span><span class="inline-code"><code>UNION</code></span></span> to succeed, the queries before and after it must have the same number of columns. Most databases require that the data types of the results match up as well. SQLite's dynamic typing feature allows you to mix data types within the same column. See  <span><a href="/data_types">Data Types</a></span> for more information.</p><p>The column names from the first query are used in the resulting set.</p><p>This example shows one use case for  <span><span class="inline-code"><code>UNION</code></span></span>. Sometimes you will encounter separate tables that have the same structure. In this scenario, orders from the previous year are moved into another table as an archived copy.</p><p>This technique can improve database performance with large datasets by limiting the amount of rows the database needs to check for queries against this year's orders.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);
CREATE TABLE archived_orders_2023(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 19, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (8, &#39;Tiny Fresh Scent Tree&#39;, &#39;Automotive&#39;, 2.00, 7, 4);
    
INSERT INTO orders VALUES
    (1, 4, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 5, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (4, 2, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (5, 3, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (6, 6, 10, &#39;2024-09-01 08:01:01&#39;, NULL);
    
INSERT INTO archived_orders_2023 VALUES
    (7, 1, 20, &#39;2023-12-15 10:30:00&#39;, &#39;2023-12-20 14:15:00&#39;),
    (8, 2, 25, &#39;2023-11-28 08:45:22&#39;, &#39;2023-12-02 11:20:15&#39;),
    (9, 4, 40, &#39;2023-08-22 11:05:15&#39;, &#39;2023-08-29 15:30:00&#39;),
    (10, 8, 100, &#39;2023-07-14 09:20:00&#39;, &#39;2023-07-18 10:15:30&#39;),
    (11, 6, 5, &#39;2023-06-30 14:55:25&#39;, &#39;2023-07-05 16:40:10&#39;),
    (12, 7, 10, &#39;2023-05-12 07:30:00&#39;, &#39;2023-05-16 13:25:45&#39;);`, `SELECT product_id, quantity
FROM orders
UNION
SELECT product_id, quantity
FROM archived_orders_2023;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div><p><span><span class="inline-code"><code>UNION ALL</code></span></span> is a modifier that preserves duplicates in the resulting set.</p><p><span><span class="inline-code"><code>UNION</code></span></span> ignores duplicate rows by default.</p><p>Both tables contain some orders with the same  <span><span class="inline-code"><code>product_id</code></span></span> and  <span><span class="inline-code"><code>quantity</code></span></span>, so they are treated as duplicates by  <span><span class="inline-code"><code>UNION</code></span></span>.</p><p>As an aside, notice how the previous example had results ordered by  <span><span class="inline-code"><code>product_id</code></span></span> and this example has no meaningful order. This shows us how a database engine will typically return rows in whatever order it decides is most efficient to compute unless we supply an  <span><span class="inline-code"><code>ORDER BY</code></span></span> clause.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);
CREATE TABLE archived_orders_2023(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 19, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (8, &#39;Tiny Fresh Scent Tree&#39;, &#39;Automotive&#39;, 2.00, 7, 4);
    
INSERT INTO orders VALUES
    (1, 4, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 5, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (4, 2, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (5, 3, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (6, 6, 10, &#39;2024-09-01 08:01:01&#39;, NULL);
    
INSERT INTO archived_orders_2023 VALUES
    (7, 1, 20, &#39;2023-12-15 10:30:00&#39;, &#39;2023-12-20 14:15:00&#39;),
    (8, 2, 25, &#39;2023-11-28 08:45:22&#39;, &#39;2023-12-02 11:20:15&#39;),
    (9, 4, 40, &#39;2023-08-22 11:05:15&#39;, &#39;2023-08-29 15:30:00&#39;),
    (10, 8, 100, &#39;2023-07-14 09:20:00&#39;, &#39;2023-07-18 10:15:30&#39;),
    (11, 6, 5, &#39;2023-06-30 14:55:25&#39;, &#39;2023-07-05 16:40:10&#39;),
    (12, 7, 10, &#39;2023-05-12 07:30:00&#39;, &#39;2023-05-16 13:25:45&#39;);`, `SELECT product_id, quantity
FROM orders
UNION ALL
SELECT product_id, quantity
FROM archived_orders_2023;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div><p><span><span class="inline-code"><code>UNION</code></span></span> can be chained multiple times to keep appending rows to the result from multiple queries.</p><p>This example also shows how you can  <span><span class="inline-code"><code>SELECT</code></span></span> constants or computed columns and use them in a  <span><span class="inline-code"><code>UNION</code></span></span>. This can be a useful technique to include ad-hoc data that doesn't exist in a table.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);
CREATE TABLE archived_orders_2023(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 19, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (8, &#39;Tiny Fresh Scent Tree&#39;, &#39;Automotive&#39;, 2.00, 7, 4);
    
INSERT INTO orders VALUES
    (1, 4, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 5, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (4, 2, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (5, 3, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (6, 6, 10, &#39;2024-09-01 08:01:01&#39;, NULL);
    
INSERT INTO archived_orders_2023 VALUES
    (7, 1, 20, &#39;2023-12-15 10:30:00&#39;, &#39;2023-12-20 14:15:00&#39;),
    (8, 2, 25, &#39;2023-11-28 08:45:22&#39;, &#39;2023-12-02 11:20:15&#39;),
    (9, 4, 40, &#39;2023-08-22 11:05:15&#39;, &#39;2023-08-29 15:30:00&#39;),
    (10, 8, 100, &#39;2023-07-14 09:20:00&#39;, &#39;2023-07-18 10:15:30&#39;),
    (11, 6, 5, &#39;2023-06-30 14:55:25&#39;, &#39;2023-07-05 16:40:10&#39;),
    (12, 7, 10, &#39;2023-05-12 07:30:00&#39;, &#39;2023-05-16 13:25:45&#39;);`, `SELECT product_id, quantity
FROM orders
UNION ALL
SELECT product_id, quantity
FROM archived_orders_2023
UNION ALL
SELECT 10, 100;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div><p>Ad-hoc data supplied to a  <span><span class="inline-code"><code>UNION</code></span></span> can be a useful technique to create separate "utility" tables as well.</p><p>Here we construct a table called  <span><span class="inline-code"><code>shelf_life</code></span></span> which maps a product category to a number of days of shelf life. Note again that we only need to alias the columns of the first input to the  <span><span class="inline-code"><code>UNION</code></span></span> because those column names will be used for all the rows in the result.</p><p>Note that this example also demonstrates a  <span><a href="/common_table_expressions">Common Table Expression</a></span> to construct the  <span><span class="inline-code"><code>shelf_life</code></span></span> table for later use in the query.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);
CREATE TABLE archived_orders_2023(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 19, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (8, &#39;Tiny Fresh Scent Tree&#39;, &#39;Automotive&#39;, 2.00, 7, 4);
    
INSERT INTO orders VALUES
    (1, 4, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 5, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (4, 2, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (5, 3, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (6, 6, 10, &#39;2024-09-01 08:01:01&#39;, NULL);
    
INSERT INTO archived_orders_2023 VALUES
    (7, 1, 20, &#39;2023-12-15 10:30:00&#39;, &#39;2023-12-20 14:15:00&#39;),
    (8, 2, 25, &#39;2023-11-28 08:45:22&#39;, &#39;2023-12-02 11:20:15&#39;),
    (9, 4, 40, &#39;2023-08-22 11:05:15&#39;, &#39;2023-08-29 15:30:00&#39;),
    (10, 8, 100, &#39;2023-07-14 09:20:00&#39;, &#39;2023-07-18 10:15:30&#39;),
    (11, 6, 5, &#39;2023-06-30 14:55:25&#39;, &#39;2023-07-05 16:40:10&#39;),
    (12, 7, 10, &#39;2023-05-12 07:30:00&#39;, &#39;2023-05-16 13:25:45&#39;);`, `WITH shelf_life AS (
    SELECT &#39;Food&#39; AS category, 21 AS shelf_life_days
    UNION
    SELECT &#39;Toiletries&#39;, 365*2
    UNION
    SELECT &#39;Pet Care&#39;, 365
    UNION
    SELECT &#39;Automotive&#39;, 365*5
)
SELECT p.name, p.category, sl.shelf_life_days
FROM products p
INNER JOIN shelf_life sl
ON p.category = sl.category;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div>The result of a  <span><span class="inline-code"><code>UNION</code></span></span> is treated the same as any other  <span><span class="inline-code"><code>SELECT</code></span></span> statement, so it can be used with aggregate clauses like  <span><span class="inline-code"><code>GROUP BY</code></span></span>. This example shows how we can calculate the total purchased quantity of items by year.</div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);
CREATE TABLE archived_orders_2023(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 19, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (8, &#39;Tiny Fresh Scent Tree&#39;, &#39;Automotive&#39;, 2.00, 7, 4);
    
INSERT INTO orders VALUES
    (1, 4, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 5, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (4, 2, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (5, 3, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (6, 6, 10, &#39;2024-09-01 08:01:01&#39;, NULL);
    
INSERT INTO archived_orders_2023 VALUES
    (7, 1, 20, &#39;2023-12-15 10:30:00&#39;, &#39;2023-12-20 14:15:00&#39;),
    (8, 2, 25, &#39;2023-11-28 08:45:22&#39;, &#39;2023-12-02 11:20:15&#39;),
    (9, 4, 40, &#39;2023-08-22 11:05:15&#39;, &#39;2023-08-29 15:30:00&#39;),
    (10, 8, 100, &#39;2023-07-14 09:20:00&#39;, &#39;2023-07-18 10:15:30&#39;),
    (11, 6, 5, &#39;2023-06-30 14:55:25&#39;, &#39;2023-07-05 16:40:10&#39;),
    (12, 7, 10, &#39;2023-05-12 07:30:00&#39;, &#39;2023-05-16 13:25:45&#39;);`, `SELECT 2024 AS year, sum(quantity) AS purchase_volume
FROM orders
UNION ALL
SELECT 2023 AS year, sum(quantity)
FROM archived_orders_2023
GROUP BY year;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div><p><span><span class="inline-code"><code>INTERSECT</code></span></span> is an operator available in some databases that is used to return only the rows that are shared by both input sets.</p><p>Think of a  <span><span class="inline-code"><code>UNION</code></span></span> as being inclusive, or as growing the result set, while an  <span><span class="inline-code"><code>INTERSECT</code></span></span> is exclusive, or shrinking the result set. In terms of a  <span><span><a href="https://en.wikipedia.org/wiki/Venn_diagram">Venn Diagram</a><svg style="display: inline; width: 0.8rem; height: 0.8rem;" viewbox="0 0 48 48"><path d="M36 24c-1.2 0-2 0.8-2 2v12c0 1.2-0.8 2-2 2h-22c-1.2 0-2-0.8-2-2v-22c0-1.2 0.8-2 2-2h12c1.2 0 2-0.8 2-2s-0.8-2-2-2h-12c-3.4 0-6 2.6-6 6v22c0 3.4 2.6 6 6 6h22c3.4 0 6-2.6 6-6v-12c0-1.2-0.8-2-2-2z"></path> <path d="M43.8 5.2c-0.2-0.4-0.6-0.8-1-1-0.2-0.2-0.6-0.2-0.8-0.2h-12c-1.2 0-2 0.8-2 2s0.8 2 2 2h7.2l-18.6 18.6c-0.8 0.8-0.8 2 0 2.8 0.4 0.4 0.8 0.6 1.4 0.6s1-0.2 1.4-0.6l18.6-18.6v7.2c0 1.2 0.8 2 2 2s2-0.8 2-2v-12c0-0.2 0-0.6-0.2-0.8z"></path></svg></span></span>,  <span><span class="inline-code"><code>INTERSECT</code></span></span> is equivalent to the area where the two circles overlap.</p><p>In this example we show how  <span><span class="inline-code"><code>INTERSECT</code></span></span> helps us find out which orders we made in 2024 are identical to orders we made in 2023.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);
CREATE TABLE archived_orders_2023(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 19, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (8, &#39;Tiny Fresh Scent Tree&#39;, &#39;Automotive&#39;, 2.00, 7, 4);
    
INSERT INTO orders VALUES
    (1, 4, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 5, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (4, 2, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (5, 3, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (6, 6, 10, &#39;2024-09-01 08:01:01&#39;, NULL);
    
INSERT INTO archived_orders_2023 VALUES
    (7, 1, 20, &#39;2023-12-15 10:30:00&#39;, &#39;2023-12-20 14:15:00&#39;),
    (8, 2, 25, &#39;2023-11-28 08:45:22&#39;, &#39;2023-12-02 11:20:15&#39;),
    (9, 4, 40, &#39;2023-08-22 11:05:15&#39;, &#39;2023-08-29 15:30:00&#39;),
    (10, 8, 100, &#39;2023-07-14 09:20:00&#39;, &#39;2023-07-18 10:15:30&#39;),
    (11, 6, 5, &#39;2023-06-30 14:55:25&#39;, &#39;2023-07-05 16:40:10&#39;),
    (12, 7, 10, &#39;2023-05-12 07:30:00&#39;, &#39;2023-05-16 13:25:45&#39;);`, `SELECT product_id, quantity
FROM orders
INTERSECT
SELECT product_id, quantity
FROM archived_orders_2023;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div>For reference,  <span><span class="inline-code"><code>INTERSECT</code></span></span> is functionally equivalent to a  <span><span class="inline-code"><code>JOIN</code></span></span> with a  <span><span class="inline-code"><code>DISTINCT</code></span></span> clause to eliminate duplicates.</div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);
CREATE TABLE archived_orders_2023(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 19, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (8, &#39;Tiny Fresh Scent Tree&#39;, &#39;Automotive&#39;, 2.00, 7, 4);
    
INSERT INTO orders VALUES
    (1, 4, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 5, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (4, 2, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (5, 3, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (6, 6, 10, &#39;2024-09-01 08:01:01&#39;, NULL);
    
INSERT INTO archived_orders_2023 VALUES
    (7, 1, 20, &#39;2023-12-15 10:30:00&#39;, &#39;2023-12-20 14:15:00&#39;),
    (8, 2, 25, &#39;2023-11-28 08:45:22&#39;, &#39;2023-12-02 11:20:15&#39;),
    (9, 4, 40, &#39;2023-08-22 11:05:15&#39;, &#39;2023-08-29 15:30:00&#39;),
    (10, 8, 100, &#39;2023-07-14 09:20:00&#39;, &#39;2023-07-18 10:15:30&#39;),
    (11, 6, 5, &#39;2023-06-30 14:55:25&#39;, &#39;2023-07-05 16:40:10&#39;),
    (12, 7, 10, &#39;2023-05-12 07:30:00&#39;, &#39;2023-05-16 13:25:45&#39;);`, `SELECT DISTINCT o.product_id, o.quantity
FROM orders o
INNER JOIN archived_orders_2023 ao
ON o.product_id = ao.product_id
AND o.quantity = ao.quantity;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div><p>The  <span><span class="inline-code"><code>EXCEPT</code></span></span> operator returns rows from the first set that do not exist in the second set. Think of it as a way to subtract the second set from the first set. Some databases call this operator  <span><span class="inline-code"><code>MINUS</code></span></span>.</p><p>This example shows all the orders from 2024 that did not have identical orders placed in 2023.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);
CREATE TABLE archived_orders_2023(id INTEGER PRIMARY KEY, product_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 19, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (8, &#39;Tiny Fresh Scent Tree&#39;, &#39;Automotive&#39;, 2.00, 7, 4);
    
INSERT INTO orders VALUES
    (1, 4, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 5, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (4, 2, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (5, 3, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (6, 6, 10, &#39;2024-09-01 08:01:01&#39;, NULL);
    
INSERT INTO archived_orders_2023 VALUES
    (7, 1, 20, &#39;2023-12-15 10:30:00&#39;, &#39;2023-12-20 14:15:00&#39;),
    (8, 2, 25, &#39;2023-11-28 08:45:22&#39;, &#39;2023-12-02 11:20:15&#39;),
    (9, 4, 40, &#39;2023-08-22 11:05:15&#39;, &#39;2023-08-29 15:30:00&#39;),
    (10, 8, 100, &#39;2023-07-14 09:20:00&#39;, &#39;2023-07-18 10:15:30&#39;),
    (11, 6, 5, &#39;2023-06-30 14:55:25&#39;, &#39;2023-07-05 16:40:10&#39;),
    (12, 7, 10, &#39;2023-05-12 07:30:00&#39;, &#39;2023-05-16 13:25:45&#39;);`, `SELECT product_id, quantity
FROM orders
EXCEPT
SELECT product_id, quantity
FROM archived_orders_2023;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div></div><div><small class="footer"><span class="italic"><a href="/group_by">previous: GROUP BY</a></span> <span class="italic"><a href="/">home</a></span> <span class="italic"><a href="/case">next: CASE</a></span></small></div></div></body></html>