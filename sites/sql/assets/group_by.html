<html><head><script type="text/javascript" src="assets/app.js"></script> <script defer type="text/javascript" src="assets/alpine.js"></script><link rel="stylesheet" href="assets/styles.css"><link rel="stylesheet" href="assets/prism.css"><link rel="icon" type="image/x-icon" href="assets/favicon.ico"><title>More SQL Please: GROUP BY</title></head><body class="language-sql"><div class="content wide"><div class="title"><h1 class="heading"><a href="/">More SQL Please</a>: <span class="title-em">GROUP BY</span></h1></div><details id="schema" class="toggle"><summary class="action heading" data-open="hide tables" data-close="show tables"></summary><div class="container"><div class="tile"><div class="tablename"><span><span class="inline-code"><code>products</code></span></span></div><pre class="table">| id |           name           |  category  | price | remaining_stock | vendor_id |
|----|--------------------------|------------|-------|-----------------|-----------|
| 1  | Cool Splash Cologne      | Toiletries | 49.99 | 25              | 2         |
| 2  | More Spice Please Chips  | Food       | 3.99  | 60              | 1         |
| 3  | Night Shift Coffee       | Food       | 6.99  | 1               | 1         |
| 4  | Crunchy Munchy Trail Mix | Food       | 8.99  | 5               | 3         |
| 5  | Super Glide Floss        | Toiletries | 1.99  | 49              | 4         |
| 6  | Big Bark Dog Food        | Pet Care   | 30    | 2               | 2         |
| 7  | Soft Purr Cat Food       | Pet Care   | 30    | 2               | 2         |
</pre></div><div class="tile"><div class="tablename"><span><span class="inline-code"><code>vendors</code></span></span></div><pre class="table">| id |          name           |
|----|-------------------------|
| 1  | Quicky Express Food Co  |
| 2  | Good Times Distributors |
| 3  | Natural Goodness        |
| 4  | Hyper Logistics         |
</pre></div><div class="tile"><div class="tablename"><span><span class="inline-code"><code>orders</code></span></span></div><pre class="table">| id | product_id | vendor_id | quantity |    date_ordered     |    date_arrived     |
|----|------------|-----------|----------|---------------------|---------------------|
| 1  | 4          | 3         | 40       | 2024-06-01 07:58:05 | 2024-06-03 09:04:05 |
| 2  | 1          | 2         | 20       | 2024-06-14 19:30:10 | 2024-06-26 14:20:10 |
| 3  | 4          | 3         | 40       | 2024-07-01 09:01:05 | 2024-07-13 09:01:05 |
| 4  | 5          | 4         | 50       | 2024-07-03 01:00:07 | 2024-07-09 12:50:12 |
| 5  | 2          | 1         | 60       | 2024-07-24 06:06:03 | 2024-07-30 15:05:00 |
| 6  | 3          | 1         | 60       | 2024-08-15 16:40:07 | 2024-08-19 07:05:00 |
| 7  | 6          | 4         | 10       | 2024-09-01 08:01:01 | NULL                |
| 8  | 7          | 4         | 10       | 2024-09-01 08:05:09 | NULL                |
</pre></div></div></details> <div class="container"><div><p>The  <span><span class="inline-code"><code>GROUP BY</code></span></span> statement is used when you want to group results together so you can find things out about each group. </p><p><span><span class="inline-code"><code>GROUP BY</code></span></span> is most useful when paired with an aggregate function like  <span><span class="inline-code"><code>sum()</code></span></span>, which in this case will operate once for each group instead of on all the rows together.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE vendors(id INTEGER PRIMARY KEY, name TEXT);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, vendor_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 49, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2);

INSERT INTO vendors VALUES
    (1, &#39;Quicky Express Food Co&#39;),
    (2, &#39;Good Times Distributors&#39;),
    (3, &#39;Natural Goodness&#39;),
    (4, &#39;Hyper Logistics&#39;);

INSERT INTO orders VALUES
    (1, 4, 3, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 2, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 4, 3, 40, &#39;2024-07-01 09:01:05&#39;, &#39;2024-07-13 09:01:05&#39;),
    (4, 5, 4, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (5, 2, 1, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (6, 3, 1, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (7, 6, 4, 10, &#39;2024-09-01 08:01:01&#39;, NULL),
    (8, 7, 4, 10, &#39;2024-09-01 08:05:09&#39;, NULL);`, `SELECT category, sum(remaining_stock)
    AS total_remaining
FROM products
GROUP BY category;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div>You can use multiple aggregate functions with a  <span><span class="inline-code"><code>GROUP BY</code></span></span> to find more information about each group side by side.</div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE vendors(id INTEGER PRIMARY KEY, name TEXT);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, vendor_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 49, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2);

INSERT INTO vendors VALUES
    (1, &#39;Quicky Express Food Co&#39;),
    (2, &#39;Good Times Distributors&#39;),
    (3, &#39;Natural Goodness&#39;),
    (4, &#39;Hyper Logistics&#39;);

INSERT INTO orders VALUES
    (1, 4, 3, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 2, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 4, 3, 40, &#39;2024-07-01 09:01:05&#39;, &#39;2024-07-13 09:01:05&#39;),
    (4, 5, 4, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (5, 2, 1, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (6, 3, 1, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (7, 6, 4, 10, &#39;2024-09-01 08:01:01&#39;, NULL),
    (8, 7, 4, 10, &#39;2024-09-01 08:05:09&#39;, NULL);`, `SELECT category,
    min(price) AS min_price,
    max(price) AS max_price,
    round(avg(price), 2) AS avg_price
FROM products
GROUP BY category;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div><p>The  <span><span class="inline-code"><code>HAVING</code></span></span> clause can be applied to a  <span><span class="inline-code"><code>GROUP BY</code></span></span>, which will only include rows in the group that match the clause. It is similar to a  <span><span class="inline-code"><code>WHERE</code></span></span> clause but with key differences:</p><p><span><span class="inline-code"><code>WHERE</code></span></span> filters rows before they are grouped and  <span><span class="inline-code"><code>HAVING</code></span></span> filters rows after groups are formed. Because of this, only the  <span><span class="inline-code"><code>HAVING</code></span></span> clause can accept aggeregated values.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE vendors(id INTEGER PRIMARY KEY, name TEXT);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, vendor_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 49, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2);

INSERT INTO vendors VALUES
    (1, &#39;Quicky Express Food Co&#39;),
    (2, &#39;Good Times Distributors&#39;),
    (3, &#39;Natural Goodness&#39;),
    (4, &#39;Hyper Logistics&#39;);

INSERT INTO orders VALUES
    (1, 4, 3, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 2, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 4, 3, 40, &#39;2024-07-01 09:01:05&#39;, &#39;2024-07-13 09:01:05&#39;),
    (4, 5, 4, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (5, 2, 1, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (6, 3, 1, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (7, 6, 4, 10, &#39;2024-09-01 08:01:01&#39;, NULL),
    (8, 7, 4, 10, &#39;2024-09-01 08:05:09&#39;, NULL);`, `SELECT category, sum(remaining_stock)
    AS total_remaining
FROM products
GROUP BY category
HAVING total_remaining &lt; 5;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div><p><span><span class="inline-code"><code>GROUP BY</code></span></span> can be used alongside other clauses like  <span><span class="inline-code"><code>JOIN</code></span></span>.</p><p>In logistics, lead time is how long it takes to receive something after ordering it. In this example we group by vendor then use the  <span><span class="inline-code"><code>avg()</code></span></span> function with the lead time of each order to find the average lead time for each vendor.</p><p>We group by a vendor's  <span><span class="inline-code"><code>id</code></span></span> instead of  <span><span class="inline-code"><code>name</code></span></span> because vendors might have the same name as one another but they always have a unique id. This ensures that our groups contain the correct order data for each unique vendor.</p><p><span><span class="inline-code"><code>julianday()</code></span></span> is a built-in function that helps us perform arithmetic on <a href="date_and_time">dates</a> in SQLite.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE vendors(id INTEGER PRIMARY KEY, name TEXT);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, vendor_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 49, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2);

INSERT INTO vendors VALUES
    (1, &#39;Quicky Express Food Co&#39;),
    (2, &#39;Good Times Distributors&#39;),
    (3, &#39;Natural Goodness&#39;),
    (4, &#39;Hyper Logistics&#39;);

INSERT INTO orders VALUES
    (1, 4, 3, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 2, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 4, 3, 40, &#39;2024-07-01 09:01:05&#39;, &#39;2024-07-13 09:01:05&#39;),
    (4, 5, 4, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (5, 2, 1, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (6, 3, 1, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (7, 6, 4, 10, &#39;2024-09-01 08:01:01&#39;, NULL),
    (8, 7, 4, 10, &#39;2024-09-01 08:05:09&#39;, NULL);`, `SELECT
    v.name AS vendor,
    avg(
        round(
            julianday(o.date_arrived) - 
            julianday(o.date_ordered), 
            0
        )
    ) AS average_lead_time_days
FROM vendors v
INNER JOIN orders o
ON v.id = o.vendor_id
GROUP BY v.id;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div><p>If you supply multiple columns to a  <span><span class="inline-code"><code>GROUP BY</code></span></span>, groups are formed based on all the unique combinations of data from those columns.</p><p>Here we group by both the product category and the month we made an order for that category.  <span><span class="inline-code"><code>count(*)</code></span></span> will then count how many rows are in each group, telling us how many orders there are in each group.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE vendors(id INTEGER PRIMARY KEY, name TEXT);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, vendor_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 49, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2);

INSERT INTO vendors VALUES
    (1, &#39;Quicky Express Food Co&#39;),
    (2, &#39;Good Times Distributors&#39;),
    (3, &#39;Natural Goodness&#39;),
    (4, &#39;Hyper Logistics&#39;);

INSERT INTO orders VALUES
    (1, 4, 3, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 2, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 4, 3, 40, &#39;2024-07-01 09:01:05&#39;, &#39;2024-07-13 09:01:05&#39;),
    (4, 5, 4, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (5, 2, 1, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (6, 3, 1, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (7, 6, 4, 10, &#39;2024-09-01 08:01:01&#39;, NULL),
    (8, 7, 4, 10, &#39;2024-09-01 08:05:09&#39;, NULL);`, `SELECT strftime(&#34;%m&#34;, o.date_ordered) AS month,
    p.category,
    count(*) AS total_orders
FROM orders o
INNER JOIN products p
    ON o.product_id = p.id
GROUP BY month, p.category;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div>Now lets say we want to see the most recent order totals first.  <span><span class="inline-code"><code>ORDER BY</code></span></span> can be applied at the end of the query to sort the months in descending order.</div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE vendors(id INTEGER PRIMARY KEY, name TEXT);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, vendor_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 49, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2);

INSERT INTO vendors VALUES
    (1, &#39;Quicky Express Food Co&#39;),
    (2, &#39;Good Times Distributors&#39;),
    (3, &#39;Natural Goodness&#39;),
    (4, &#39;Hyper Logistics&#39;);

INSERT INTO orders VALUES
    (1, 4, 3, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 2, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 4, 3, 40, &#39;2024-07-01 09:01:05&#39;, &#39;2024-07-13 09:01:05&#39;),
    (4, 5, 4, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (5, 2, 1, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (6, 3, 1, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (7, 6, 4, 10, &#39;2024-09-01 08:01:01&#39;, NULL),
    (8, 7, 4, 10, &#39;2024-09-01 08:05:09&#39;, NULL);`, `SELECT strftime(&#34;%m&#34;, o.date_ordered) AS month,
    p.category,
    count(*) AS total_orders
FROM orders o
INNER JOIN products p
    ON o.product_id = p.id
GROUP BY month, p.category
ORDER BY month DESC;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div><p>The  <span><span class="inline-code"><code>DISTINCT</code></span></span> clause can be added to an aggregate function like  <span><span class="inline-code"><code>count()</code></span></span>. In this case we want to see how many different vendors we have for each product category to make sure we can negotiate the best prices.</p><p>Without the  <span><span class="inline-code"><code>DISTINCT</code></span></span> clause in this query it would return a row count of all the products in each category even if the same vendor appears multiple times. We would have thought we had two Pet Care vendors when really we only have one.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE vendors(id INTEGER PRIMARY KEY, name TEXT);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, vendor_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 49, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2);

INSERT INTO vendors VALUES
    (1, &#39;Quicky Express Food Co&#39;),
    (2, &#39;Good Times Distributors&#39;),
    (3, &#39;Natural Goodness&#39;),
    (4, &#39;Hyper Logistics&#39;);

INSERT INTO orders VALUES
    (1, 4, 3, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 2, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 4, 3, 40, &#39;2024-07-01 09:01:05&#39;, &#39;2024-07-13 09:01:05&#39;),
    (4, 5, 4, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (5, 2, 1, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (6, 3, 1, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (7, 6, 4, 10, &#39;2024-09-01 08:01:01&#39;, NULL),
    (8, 7, 4, 10, &#39;2024-09-01 08:05:09&#39;, NULL);`, `SELECT category, count(DISTINCT vendor_id)
    AS vendors
FROM products
GROUP BY category;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div><p><span><span class="inline-code"><code>NULL</code></span></span> values form their own group when they are found by a  <span><span class="inline-code"><code>GROUP BY</code></span></span>.</p><p>In this schema an order has a  <span><span class="inline-code"><code>NULL</code></span></span> arrival date if it hasn't arrived yet. This query will show us unfulfilled orders as a  <span><span class="inline-code"><code>NULL</code></span></span> arrival month alongside fulfilled orders.</p><p>If we wanted something more informative to display like "Not Arrived" or "Pending", we could use the <a href="/functions#coalesce"><span><span class="inline-code"><code>coalesce()</code></span></span> function</a>.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE vendors(id INTEGER PRIMARY KEY, name TEXT);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, vendor_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 49, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2);

INSERT INTO vendors VALUES
    (1, &#39;Quicky Express Food Co&#39;),
    (2, &#39;Good Times Distributors&#39;),
    (3, &#39;Natural Goodness&#39;),
    (4, &#39;Hyper Logistics&#39;);

INSERT INTO orders VALUES
    (1, 4, 3, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 2, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 4, 3, 40, &#39;2024-07-01 09:01:05&#39;, &#39;2024-07-13 09:01:05&#39;),
    (4, 5, 4, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (5, 2, 1, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (6, 3, 1, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (7, 6, 4, 10, &#39;2024-09-01 08:01:01&#39;, NULL),
    (8, 7, 4, 10, &#39;2024-09-01 08:05:09&#39;, NULL);`, `SELECT strftime(&#34;%m&#34;, date_arrived) AS month_arrived,
    count(*) AS orders
FROM orders
GROUP BY month_arrived
ORDER BY month_arrived ASC;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div><p>As usual, a  <span><span class="inline-code"><code>WHERE</code></span></span> clause can be applied to any of these queries. This time, we filter out unfulfilled orders before they are grouped by month.</p><p>This example also shows  <span><span class="inline-code"><code>WHERE</code></span></span> and  <span><span class="inline-code"><code>HAVING</code></span></span> being used together.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE vendors(id INTEGER PRIMARY KEY, name TEXT);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, vendor_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 49, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2);

INSERT INTO vendors VALUES
    (1, &#39;Quicky Express Food Co&#39;),
    (2, &#39;Good Times Distributors&#39;),
    (3, &#39;Natural Goodness&#39;),
    (4, &#39;Hyper Logistics&#39;);

INSERT INTO orders VALUES
    (1, 4, 3, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 2, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 4, 3, 40, &#39;2024-07-01 09:01:05&#39;, &#39;2024-07-13 09:01:05&#39;),
    (4, 5, 4, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (5, 2, 1, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (6, 3, 1, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (7, 6, 4, 10, &#39;2024-09-01 08:01:01&#39;, NULL),
    (8, 7, 4, 10, &#39;2024-09-01 08:05:09&#39;, NULL);`, `SELECT count(*) AS fulfilled_orders,
    strftime(&#34;%m&#34;, date_arrived) AS month
FROM orders
WHERE month IS NOT NULL
GROUP BY month
HAVING fulfilled_orders &gt; 2
ORDER BY month ASC;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div><div><p>Any selected columns that are not part of an aggregate function or included in the  <span><span class="inline-code"><code>GROUP BY</code></span></span> clause are called "bare" columns. Many databases will treat bare columns as an error because they create ambiguity in which value to return.</p><p>In this example, "name" is the bare column. It returns a single arbitrary product name from the associated category, which isn't very useful to us.</p><p>SQLite does allow bare columns but it's generally recommended not to include them in your queries.</p></div><div class="example sticky-container fade-in"><div class="tile sticky"><div x-data="createExample(`CREATE TABLE products(id INTEGER PRIMARY KEY, name TEXT, category TEXT, price REAL, remaining_stock INTEGER, vendor_id INTEGER);
CREATE TABLE vendors(id INTEGER PRIMARY KEY, name TEXT);
CREATE TABLE orders(id INTEGER PRIMARY KEY, product_id INTEGER, vendor_id INTEGER, quantity INTEGER, date_ordered TEXT, date_arrived TEXT);

INSERT INTO products VALUES
    (1, &#39;Cool Splash Cologne&#39;, &#39;Toiletries&#39;, 49.99, 25, 2),
    (2, &#39;More Spice Please Chips&#39;, &#39;Food&#39;, 3.99, 60, 1),
    (3, &#39;Night Shift Coffee&#39;, &#39;Food&#39;, 6.99, 1, 1),
    (4, &#39;Crunchy Munchy Trail Mix&#39;, &#39;Food&#39;, 8.99, 5, 3),
    (5, &#39;Super Glide Floss&#39;, &#39;Toiletries&#39;, 1.99, 49, 4),
    (6, &#39;Big Bark Dog Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2),
    (7, &#39;Soft Purr Cat Food&#39;, &#39;Pet Care&#39;, 30.00, 2, 2);

INSERT INTO vendors VALUES
    (1, &#39;Quicky Express Food Co&#39;),
    (2, &#39;Good Times Distributors&#39;),
    (3, &#39;Natural Goodness&#39;),
    (4, &#39;Hyper Logistics&#39;);

INSERT INTO orders VALUES
    (1, 4, 3, 40, &#39;2024-06-01 07:58:05&#39;, &#39;2024-06-03 09:04:05&#39;),
    (2, 1, 2, 20, &#39;2024-06-14 19:30:10&#39;, &#39;2024-06-26 14:20:10&#39;),
    (3, 4, 3, 40, &#39;2024-07-01 09:01:05&#39;, &#39;2024-07-13 09:01:05&#39;),
    (4, 5, 4, 50, &#39;2024-07-03 01:00:07&#39;, &#39;2024-07-09 12:50:12&#39;),
    (5, 2, 1, 60, &#39;2024-07-24 06:06:03&#39;, &#39;2024-07-30 15:05:00&#39;),
    (6, 3, 1, 60, &#39;2024-08-15 16:40:07&#39;, &#39;2024-08-19 07:05:00&#39;),
    (7, 6, 4, 10, &#39;2024-09-01 08:01:01&#39;, NULL),
    (8, 7, 4, 10, &#39;2024-09-01 08:05:09&#39;, NULL);`, `SELECT name, category
FROM products
GROUP BY category;`)"><div class="stmt"><textarea spellcheck="false" autocorrect="off" autocapitalize="off" x-init="$watch(&#39;stmt&#39;, () =&gt; { $el.parentNode.dataset.replicatedValue = $el.value })" x-model="stmt"></textarea><pre><code class="language-sql" x-init="$watch(&#39;stmt&#39;, () =&gt; {
                                $nextTick(() =&gt; Prism.highlightElement($el))
                            })" x-text="stmt"></code></pre></div><button class="run" x-on:click="run()"><img src="assets/run.svg"> run</button> <button class="run" x-on:click="reset()"><img src="assets/reset.svg"> reset</button><div class="result" x-text="result"></div></div></div></div></div><div><small class="footer"><span class="italic"><a href="/aggregate_functions">previous: Aggregate Functions</a></span> <span class="italic"><a href="/">home</a></span> <span class="italic"><a href="/union_and_set_operators">next: UNION and Set Operators</a></span></small></div></div></body></html>